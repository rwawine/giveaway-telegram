{% extends "base.html" %}

{% block title %}–†–æ–∑—ã–≥—Ä—ã—à{% endblock %}

{% block content %}
<div class="p-6 space-y-6">
  <h1 class="text-2xl font-bold text-slate-900">–ü—Ä–æ–≤–µ–¥–µ–Ω–∏–µ —Ä–æ–∑—ã–≥—Ä—ã—à–∞</h1>
  <div class="bg-white border border-slate-200 rounded-xl p-6">
    <p class="text-slate-600 mb-4">–†–æ–∑—ã–≥—Ä—ã—à –≤—ã–±–∏—Ä–∞–µ—Ç –ø–æ –æ–¥–Ω–æ–º—É –ø–æ–±–µ–¥–∏—Ç–µ–ª—é –∏–∑ –∫–∞–∂–¥–æ–π –∞–∫—Ü–∏–∏ ("–û–ø–ª–∞—Ç–∞ —É–ª—ã–±–∫–æ–π" –∏ "–°—É–±–∞–∫—Ü–∏—è"). –£—á–∞—Å—Ç–≤—É—é—Ç —Ç–æ–ª—å–∫–æ –∑–∞—è–≤–∫–∏ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º –º–æ–¥–µ—Ä–∞—Ü–∏–∏ "–û–¥–æ–±—Ä–µ–Ω–æ".</p>
    <button id="drawBtn" class="inline-flex items-center justify-center rounded-md bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 font-semibold"><i class="fas fa-dice mr-2"></i>–ü—Ä–æ–≤–µ—Å—Ç–∏ —Ä–æ–∑—ã–≥—Ä—ã—à</button>
    <div id="drawResult" class="mt-6 text-sm"></div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
const btn = document.getElementById('drawBtn');
const out = document.getElementById('drawResult');
btn?.addEventListener('click', async () => {
  btn.disabled = true; btn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è...';
  try {
    const res = await fetch('/winners/draw-lottery', { method: 'POST' });
    const data = await res.json();
    if (!data.success) throw new Error(data.error || '–û—à–∏–±–∫–∞');
    const w = data.result.winners || {};
    out.innerHTML = `
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        ${['smile_500','sub_1500'].map(key => w[key] ? `
          <div class="p-4 border rounded-lg">
            <div class="font-semibold mb-1">${key === 'smile_500' ? '–û–ø–ª–∞—Ç–∞ —É–ª—ã–±–∫–æ–π' : '–°—É–±–∞–∫—Ü–∏—è'}</div>
            <div>üë§ ${w[key].name}</div>
            <div>üßæ ****${(w[key].loyalty_card_number || '').slice(-4)}</div>
            <div>üìû ${w[key].phone_number}</div>
          </div>` : `
          <div class="p-4 border rounded-lg text-slate-500">–ù–µ—Ç —É—á–∞—Å—Ç–Ω–∏–∫–∞ –¥–ª—è ${key}</div>`).join('')}
      </div>`;
  } catch (e) {
    out.textContent = '–û—à–∏–±–∫–∞: ' + e.message;
  } finally {
    btn.disabled = false; btn.innerHTML = '<i class="fas fa-dice mr-2"></i>–ü—Ä–æ–≤–µ—Å—Ç–∏ —Ä–æ–∑—ã–≥—Ä—ã—à';
  }
});
</script>
{% endblock %}
