"""
–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
"""

import os
from typing import List
import socket
from dotenv import load_dotenv

# –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–∑ .env —Ñ–∞–π–ª–∞
load_dotenv()

# –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
BOT_TOKEN = os.getenv('BOT_TOKEN', 'YOUR_BOT_TOKEN_HERE')
ADMIN_PASSWORD = os.getenv('ADMIN_PASSWORD', 'admin123')
WEB_PORT = int(os.getenv('WEB_PORT', '5000'))
WEB_BASE_URL = os.getenv('WEB_BASE_URL', 'http://127.0.0.1:5000')


def get_local_ip() -> str:
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω—ã–π IP-–∞–¥—Ä–µ—Å –º–∞—à–∏–Ω—ã (LAN), —Å –Ω–∞–¥–µ–∂–Ω—ã–º —Ñ–æ–ª–±—ç–∫–æ–º –Ω–∞ 127.0.0.1"""
    try:
        s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
        s.connect(("8.8.8.8", 80))
        ip = s.getsockname()[0]
        s.close()
        return ip
    except Exception:
        return "127.0.0.1"


def get_web_base_url() -> str:
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –±–∞–∑–æ–≤—ã–π URL –≤–µ–±-–∞–¥–º–∏–Ω–∫–∏. –ï—Å–ª–∏ WEB_BASE_URL –Ω–µ –∑–∞–¥–∞–Ω, –≤—ã—á–∏—Å–ª—è–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏."""
    explicit = os.getenv('WEB_BASE_URL')
    if explicit and explicit.strip():
        return explicit.strip()
    return f"http://{get_local_ip()}:{WEB_PORT}"


# –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ä–∞—Å—Å—ã–ª–∫–∏ / –∞–Ω—Ç–∏-—Ñ–ª—É–¥ (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ —á–µ—Ä–µ–∑ .env)
BROADCAST_RATE_PER_SEC = int(os.getenv('BROADCAST_RATE_PER_SEC', '8'))  # –±–µ–∑–æ–ø–∞—Å–Ω–æ < 30
BROADCAST_MAX_RETRIES = int(os.getenv('BROADCAST_MAX_RETRIES', '3'))
BROADCAST_RETRY_BASE_DELAY = float(os.getenv('BROADCAST_RETRY_BASE_DELAY', '1.0'))

# ID –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ (–º–æ–∂–Ω–æ –∑–∞–¥–∞—Ç—å —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è)
ADMIN_IDS: List[int] = [
    int(id_str) for id_str in os.getenv('ADMIN_IDS', '').split(',') 
    if id_str.strip().isdigit()
]

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
DATABASE_PATH = 'applications.db'

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ñ–∞–π–ª–æ–≤
PHOTOS_DIR = 'photos'
EXPORTS_DIR = 'exports'

# –°–æ–æ–±—â–µ–Ω–∏—è –±–æ—Ç–∞
MESSAGES = {
    'welcome': (
        "üéâ **–î–û–ë–†–û –ü–û–ñ–ê–õ–û–í–ê–¢–¨ –í –†–û–ó–´–ì–†–´–® –ü–†–ò–ó–û–í!**\n\n"
        "üéØ –ì–æ—Ç–æ–≤—ã –≤—ã–∏–≥—Ä–∞—Ç—å –∫—Ä—É—Ç—ã–µ –ø—Ä–∏–∑—ã?\n"
        "üöÄ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∑–∞–π–º–µ—Ç –≤—Å–µ–≥–æ 1 –º–∏–Ω—É—Ç—É!\n\n"
        "üëá –í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ –≤ –º–µ–Ω—é –Ω–∏–∂–µ"
    ),
    'already_applied': (
        "üéØ **–í–´ –£–ñ–ï –£–ß–ê–°–¢–í–£–ï–¢–ï!**\n\n"
        "‚úÖ –í–∞—à–∞ –∑–∞—è–≤–∫–∞ –ø—Ä–∏–Ω—è—Ç–∞ –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è\n"
        "üìä –ú–æ–∂–µ—Ç–µ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–≤–æ–π —Å—Ç–∞—Ç—É—Å –≤ –º–µ–Ω—é\n\n"
        "üçÄ –£–¥–∞—á–∏ –≤ —Ä–æ–∑—ã–≥—Ä—ã—à–µ!"
    ),
    'application_start': (
        "üìù **–®–ê–ì 1 –∏–∑ 4 - –í–∞—à–µ –∏–º—è**\n\n"
        "üë§ –ö–∞–∫ –≤–∞—Å –∑–æ–≤—É—Ç?\n"
        "üí° –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –Ω–∞—Å—Ç–æ—è—â–µ–µ –∏–º—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–∏–∑–∞\n\n"
        "–ü—Ä–æ–≥—Ä–µ—Å—Å: [‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë] 25%"
    ),
    'ask_phone': (
        "üì± **–®–ê–ì 2 –∏–∑ 4 - –ö–æ–Ω—Ç–∞–∫—Ç**\n\n"
        "üìû –ü–æ–¥–µ–ª–∏—Ç–µ—Å—å –Ω–æ–º–µ—Ä–æ–º —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –¥–ª—è —Å–≤—è–∑–∏\n\n"
        "–ü—Ä–æ–≥—Ä–µ—Å—Å: [‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë] 50%\n\n"
        "üëá –í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–æ—Å–æ–±:"
    ),
    'ask_username': (
        "üí¨ **–®–ê–ì 3 –∏–∑ 4 - Telegram**\n\n"
        "üì± –£–∫–∞–∂–∏—Ç–µ –≤–∞—à –Ω–∏–∫ –≤ Telegram\n"
        "üí° –ù–∞–ø—Ä–∏–º–µ—Ä: @username\n\n"
        "–ü—Ä–æ–≥—Ä–µ—Å—Å: [‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë] 75%"
    ),
    'ask_photo': (
        "üì∏ **–®–ê–ì 4 –∏–∑ 4 - –§–æ—Ç–æ –ª–∏—Ñ–ª–µ—Ç–∞**\n\n"
        "üìé –û—Ç–ø—Ä–∞–≤—å—Ç–µ —á–µ—Ç–∫–æ–µ —Ñ–æ—Ç–æ –≤–∞—à–µ–≥–æ –ª–∏—Ñ–ª–µ—Ç–∞\n"
        "üí° –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ç–µ–∫—Å—Ç —á–∏—Ç–∞–µ–º\n\n"
        "–ü—Ä–æ–≥—Ä–µ—Å—Å: [‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë] 90%"
    ),
    'application_success': (
        "üéâ **–ü–û–ó–î–†–ê–í–õ–Ø–ï–ú!**\n\n"
        "‚úÖ –í—ã —É—Å–ø–µ—à–Ω–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã!\n"
        "üéØ –í–∞—à –Ω–æ–º–µ—Ä —É—á–∞—Å—Ç–Ω–∏–∫–∞: #{user_id}\n\n"
        "üìÖ –†–æ–∑—ã–≥—Ä—ã—à —Å–æ—Å—Ç–æ–∏—Ç—Å—è —Å–∫–æ—Ä–æ\n"
        "üë• –°–ª–µ–¥–∏—Ç–µ –∑–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏\n\n"
        "üçÄ –£–¥–∞—á–∏! üçÄ"
    ),
    'invalid_photo': (
        "‚ùå **–ù–ï–í–ï–†–ù–´–ô –§–û–†–ú–ê–¢**\n\n"
        "üì∏ –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ—Ç–ø—Ä–∞–≤—å—Ç–µ —Ñ–æ—Ç–æ –ª–∏—Ñ–ª–µ—Ç–∞\n"
        "üí° –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è: JPG, PNG (–¥–æ 10 –ú–ë)"
    ),
    'error': (
        "üòî **–ü–†–û–ò–ó–û–®–õ–ê –û–®–ò–ë–ö–ê**\n\n"
        "üîÑ –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑ —á–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥\n"
        "‚ùì –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è - –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É"
    ),
    'admin_not_authorized': "üîí **–î–û–°–¢–£–ü –ó–ê–ü–†–ï–©–ï–ù**\n\n‚ùå –£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞",
    'no_applications': "üìã **–ü–£–°–¢–û**\n\nü§∑‚Äç‚ôÇÔ∏è –ó–∞—è–≤–æ–∫ –ø–æ–∫–∞ –Ω–µ—Ç. –ö–∞–∫ —Ç–æ–ª—å–∫–æ –ø–æ—è–≤—è—Ç—Å—è - —É–≤–∏–¥–∏—Ç–µ –∑–¥–µ—Å—å!",
    'winner_selected': "üèÜ **–ü–û–ë–ï–î–ò–¢–ï–õ–¨ –û–ü–†–ï–î–ï–õ–ï–ù!**\n\nüéä –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º: **{name}** (@{username})",
    'export_ready': "üìä **–≠–ö–°–ü–û–†–¢ –ì–û–¢–û–í!**\n\n‚úÖ –§–∞–π–ª –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω",
    'status_check': (
        "üìã **–í–ê–® –°–¢–ê–¢–£–° –í –†–û–ó–´–ì–†–´–®–ï**\n\n"
        "‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n"
        "‚îÇ üë§ –£—á–∞—Å—Ç–Ω–∏–∫ #{user_id}              ‚îÇ\n"
        "‚îÇ                             ‚îÇ\n"
        "‚îÇ ‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞    ‚îÇ\n"
        "‚îÇ üìÖ –î–∞—Ç–∞: {date}  ‚îÇ\n"
        "‚îÇ                             ‚îÇ\n"
        "‚îÇ üéØ –°—Ç–∞—Ç—É—Å: –ê–∫—Ç–∏–≤–Ω—ã–π —É—á–∞—Å—Ç–Ω–∏–∫‚îÇ\n"
        "‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò"
    ),
    'help_message': (
        "‚ùì **–°–ü–†–ê–í–ö–ê –ü–û –ë–û–¢–£**\n\n"
        "üéØ **–ö–∞–∫ –ø—Ä–∏–Ω—è—Ç—å —É—á–∞—Å—Ç–∏–µ:**\n"
        "1Ô∏è‚É£ –ù–∞–∂–º–∏—Ç–µ \"üéØ –£—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å\"\n"
        "2Ô∏è‚É£ –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –¥–∞–Ω–Ω—ã–µ\n"
        "3Ô∏è‚É£ –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–æ—Ç–æ –ª–∏—Ñ–ª–µ—Ç–∞\n"
        "4Ô∏è‚É£ –î–æ–∂–¥–∏—Ç–µ—Å—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤\n\n"
        "üìã **–ü—Ä–∞–≤–∏–ª–∞:**\n"
        "‚Ä¢ –û–¥–Ω–∞ –∑–∞—è–≤–∫–∞ –Ω–∞ —á–µ–ª–æ–≤–µ–∫–∞\n"
        "‚Ä¢ –í—Å–µ –ø–æ–ª—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã\n"
        "‚Ä¢ –§–æ—Ç–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —á–µ—Ç–∫–∏–º\n\n"
        "üèÜ **–†–æ–∑—ã–≥—Ä—ã—à —á–µ—Å—Ç–Ω—ã–π –∏ –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π!**\n"
        "–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π –∞–ª–≥–æ—Ä–∏—Ç–º"
    ),

    'support_message_prompt': """üÜò **–ü–û–î–î–ï–†–ñ–ö–ê**

–û–ø–∏—à–∏—Ç–µ –≤–∞—à—É –ø—Ä–æ–±–ª–µ–º—É –∏–ª–∏ –≤–æ–ø—Ä–æ—Å, –∏ –º—ã –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –≤–∞–º –ø–æ–º–æ–∂–µ–º!

‚úçÔ∏è –ù–∞–ø–∏—à–∏—Ç–µ –≤–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:"""

}


# –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã
KEYBOARD_BUTTONS = {
    # –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
    'apply': "üéØ –£—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å",
    'status': "üìã –ú–æ–π —Å—Ç–∞—Ç—É—Å",
    'about': "üìñ –û —Ä–æ–∑—ã–≥—Ä—ã—à–µ",
    'help': "‚ùì –ü–æ–¥–¥–µ—Ä–∂–∫–∞",
    
    # –ü—Ä–æ—Ü–µ—Å—Å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
    'send_phone': "üì± –ü–æ–¥–µ–ª–∏—Ç—å—Å—è –∫–æ–Ω—Ç–∞–∫—Ç–æ–º",
    'enter_manual': "‚úçÔ∏è –í–≤–µ—Å—Ç–∏ –≤—Ä—É—á–Ω—É—é",
    'back': "‚¨ÖÔ∏è –ù–∞–∑–∞–¥",
    'cancel': "‚ùå –û—Ç–º–µ–Ω–∏—Ç—å",
    'confirm': "‚úÖ –í—Å—ë –≤–µ—Ä–Ω–æ, –æ—Ç–ø—Ä–∞–≤–∏—Ç—å",
    'edit': "‚úèÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ",
    
    # –ê–¥–º–∏–Ω
    'admin_panel': "üîê –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å",
    'admin_users': "üë• –£—á–∞—Å—Ç–Ω–∏–∫–∏",
    'admin_stats': "üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞",
    'admin_export': "üì• –≠–∫—Å–ø–æ—Ä—Ç",
    'admin_broadcast': "üì® –†–∞—Å—Å—ã–ª–∫–∞",
    'admin_winner': "üé∞ –†–æ–∑—ã–≥—Ä—ã—à",
}

# –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏
SUPPORT_MESSAGES = {
    'support_start': """üÜò **–ü–û–î–î–ï–†–ñ–ö–ê**

–û–ø–∏—à–∏—Ç–µ —Å–≤–æ—é –ø—Ä–æ–±–ª–µ–º—É –∏–ª–∏ –≤–æ–ø—Ä–æ—Å, –∏ –º—ã –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –≤–∞–º –ø–æ–º–æ–∂–µ–º!

‚úçÔ∏è –ù–∞–ø–∏—à–∏—Ç–µ –≤–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:""",
    
    'support_sent': """‚úÖ **–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!**

–í–∞—à–µ –æ–±—Ä–∞—â–µ–Ω–∏–µ –ø–µ—Ä–µ–¥–∞–Ω–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º. 
–û—Ç–≤–µ—Ç –ø—Ä–∏–¥–µ—Ç –≤ —Ç–µ—á–µ–Ω–∏–µ 24 —á–∞—Å–æ–≤.

üìû –ù–æ–º–µ—Ä –æ–±—Ä–∞—â–µ–Ω–∏—è: #{ticket_id}""",
    
    'support_reply_prompt': """üí¨ **–û–¢–í–ï–¢ –ù–ê –û–ë–†–ê–©–ï–ù–ò–ï #{ticket_id}**

–û—Ç: {user_name} (@{username})
–°–æ–æ–±—â–µ–Ω–∏–µ: "{message}"

‚úçÔ∏è –í–≤–µ–¥–∏—Ç–µ –≤–∞—à –æ—Ç–≤–µ—Ç:""",
    
    'admin_support_new': """üÜò **–ù–û–í–û–ï –û–ë–†–ê–©–ï–ù–ò–ï #{ticket_id}**

üë§ –û—Ç: {user_name} (@{username})
üÜî ID: {user_id}
üìÖ –í—Ä–µ–º—è: {timestamp}

üí¨ **–°–æ–æ–±—â–µ–Ω–∏–µ:**
"{message}"

üìù –û—Ç–≤–µ—Ç–∏—Ç—å: /reply_{ticket_id}""",
}
